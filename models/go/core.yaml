# Go Core Taint Configuration
# Base sources, sinks, and sanitizers for Go applications

sources:
  # Command Line
  - name: "os.Args"
    kind: UserInput
    description: "Command line arguments"

  - name: "flag.String"
    kind: UserInput
    package: "flag"
    description: "Flag string value"

  - name: "flag.Int"
    kind: UserInput
    package: "flag"
    description: "Flag int value"

  - name: "flag.Arg"
    kind: UserInput
    package: "flag"
    description: "Flag argument"

  - name: "flag.Args"
    kind: UserInput
    package: "flag"
    description: "Flag arguments"

  # HTTP (net/http)
  - name: "r.FormValue"
    kind: UserInput
    description: "HTTP form value"

  - name: "r.URL.Query"
    kind: UserInput
    description: "HTTP query parameters"

  - name: "r.URL.Query().Get"
    kind: UserInput
    description: "HTTP query parameter"

  - name: "r.URL.Path"
    kind: UserInput
    description: "HTTP URL path"

  - name: "r.URL.RawQuery"
    kind: UserInput
    description: "HTTP raw query string"

  - name: "r.PostFormValue"
    kind: UserInput
    description: "HTTP POST form value"

  - name: "r.MultipartForm"
    kind: UserInput
    description: "HTTP multipart form"

  - name: "r.Header.Get"
    kind: UserInput
    description: "HTTP header value"

  - name: "r.Header.Values"
    kind: UserInput
    description: "HTTP header values"

  - name: "r.Cookie"
    kind: UserInput
    description: "HTTP cookie"

  - name: "r.Cookies"
    kind: UserInput
    description: "HTTP cookies"

  - name: "r.Body"
    kind: UserInput
    description: "HTTP request body"

  - name: "r.Host"
    kind: UserInput
    description: "HTTP request host"

  - name: "r.RemoteAddr"
    kind: UserInput
    description: "HTTP remote address"

  - name: "r.RequestURI"
    kind: UserInput
    description: "HTTP request URI"

  - name: "r.Referer"
    kind: UserInput
    description: "HTTP referer"

  - name: "r.UserAgent"
    kind: UserInput
    description: "HTTP user agent"

  # Gin Framework
  - name: "c.Query"
    kind: UserInput
    description: "Gin query parameter"

  - name: "c.DefaultQuery"
    kind: UserInput
    description: "Gin query parameter with default"

  - name: "c.QueryArray"
    kind: UserInput
    description: "Gin query parameter array"

  - name: "c.QueryMap"
    kind: UserInput
    description: "Gin query parameter map"

  - name: "c.Param"
    kind: UserInput
    description: "Gin URL parameter"

  - name: "c.PostForm"
    kind: UserInput
    description: "Gin POST form value"

  - name: "c.DefaultPostForm"
    kind: UserInput
    description: "Gin POST form value with default"

  - name: "c.PostFormArray"
    kind: UserInput
    description: "Gin POST form array"

  - name: "c.PostFormMap"
    kind: UserInput
    description: "Gin POST form map"

  - name: "c.FormFile"
    kind: UserInput
    description: "Gin form file"

  - name: "c.MultipartForm"
    kind: UserInput
    description: "Gin multipart form"

  - name: "c.GetHeader"
    kind: UserInput
    description: "Gin request header"

  - name: "c.Cookie"
    kind: UserInput
    description: "Gin cookie"

  - name: "c.GetRawData"
    kind: UserInput
    description: "Gin raw request body"

  - name: "c.Request.Body"
    kind: UserInput
    description: "Gin request body"

  - name: "c.ClientIP"
    kind: UserInput
    description: "Gin client IP"

  - name: "c.FullPath"
    kind: UserInput
    description: "Gin full path"

  # Echo Framework
  - name: "c.QueryParam"
    kind: UserInput
    description: "Echo query parameter"

  - name: "c.QueryParams"
    kind: UserInput
    description: "Echo query parameters"

  - name: "c.QueryString"
    kind: UserInput
    description: "Echo query string"

  - name: "c.FormValue"
    kind: UserInput
    description: "Echo form value"

  - name: "c.FormParams"
    kind: UserInput
    description: "Echo form parameters"

  - name: "c.FormFile"
    kind: UserInput
    description: "Echo form file"

  - name: "c.MultipartForm"
    kind: UserInput
    description: "Echo multipart form"

  - name: "c.PathParam"
    kind: UserInput
    description: "Echo path parameter"

  - name: "c.PathParams"
    kind: UserInput
    description: "Echo path parameters"

  - name: "c.Request().Header.Get"
    kind: UserInput
    description: "Echo request header"

  - name: "c.Cookie"
    kind: UserInput
    description: "Echo cookie"

  - name: "c.Cookies"
    kind: UserInput
    description: "Echo cookies"

  - name: "c.Request().Body"
    kind: UserInput
    description: "Echo request body"

  - name: "c.RealIP"
    kind: UserInput
    description: "Echo real IP"

  # Fiber Framework
  - name: "c.Query"
    kind: UserInput
    description: "Fiber query parameter"

  - name: "c.Params"
    kind: UserInput
    description: "Fiber URL parameter"

  - name: "c.FormValue"
    kind: UserInput
    description: "Fiber form value"

  - name: "c.Body"
    kind: UserInput
    description: "Fiber request body"

  - name: "c.BodyRaw"
    kind: UserInput
    description: "Fiber raw body"

  - name: "c.Get"
    kind: UserInput
    description: "Fiber header"

  - name: "c.Cookies"
    kind: UserInput
    description: "Fiber cookies"

  - name: "c.IP"
    kind: UserInput
    description: "Fiber client IP"

  # File I/O
  - name: "os.ReadFile"
    kind: File
    description: "Read file contents"

  - name: "ioutil.ReadFile"
    kind: File
    description: "Read file contents (deprecated)"

  - name: "os.Open"
    kind: File
    description: "Open file"

  - name: "bufio.NewReader"
    kind: File
    description: "Create buffered reader"

  - name: "io.ReadAll"
    kind: File
    description: "Read all from reader"

  # Environment
  - name: "os.Getenv"
    kind: Environment
    description: "Get environment variable"

  - name: "os.LookupEnv"
    kind: Environment
    description: "Lookup environment variable"

  # Network
  - name: "http.Get"
    kind: Network
    description: "HTTP GET request"

  - name: "http.Client.Get"
    kind: Network
    description: "HTTP client GET"

  - name: "ioutil.ReadAll"
    kind: Network
    description: "Read all from reader"

  - name: "io.ReadAll"
    kind: Network
    description: "Read all from reader"

sinks:
  # Command Execution
  - name: "exec.Command"
    kind: CommandExecution
    package: "os/exec"
    description: "Execute command"
    argument: 0

  - name: "exec.CommandContext"
    kind: CommandExecution
    package: "os/exec"
    description: "Execute command with context"
    argument: 1

  - name: "syscall.Exec"
    kind: CommandExecution
    package: "syscall"
    description: "Syscall exec"
    argument: 0

  # SQL Injection
  - name: "db.Exec"
    kind: SqlQuery
    package: "database/sql"
    description: "Execute SQL"
    argument: 0

  - name: "db.Query"
    kind: SqlQuery
    package: "database/sql"
    description: "Query SQL"
    argument: 0

  - name: "db.QueryRow"
    kind: SqlQuery
    package: "database/sql"
    description: "Query single row"
    argument: 0

  - name: "tx.Exec"
    kind: SqlQuery
    description: "Transaction exec SQL"
    argument: 0

  - name: "tx.Query"
    kind: SqlQuery
    description: "Transaction query SQL"
    argument: 0

  # Custom helper SQL sinks (common in benchmarks)
  - name: "ExecuteRaw"
    kind: SqlQuery
    description: "Execute raw SQL"
    argument: 0

  - name: "helpers.ExecuteRaw"
    kind: SqlQuery
    description: "Helper execute raw SQL"
    argument: 0

  # File operations
  - name: "os.WriteFile"
    kind: FileWrite
    description: "Write file"
    argument: 0

  - name: "ioutil.WriteFile"
    kind: FileWrite
    description: "Write file (deprecated)"
    argument: 0

  - name: "os.Create"
    kind: PathTraversal
    description: "Create file"
    argument: 0

  - name: "os.OpenFile"
    kind: PathTraversal
    description: "Open file with flags"
    argument: 0

  # HTML/XSS Output
  - name: "fmt.Fprintf"
    kind: HtmlOutput
    description: "Formatted print to writer"
    argument: 1

  - name: "w.Write"
    kind: HtmlOutput
    description: "Write to response"
    argument: 0

  - name: "io.WriteString"
    kind: HtmlOutput
    description: "Write string to writer"
    argument: 1

  # Open Redirect
  - name: "http.Redirect"
    kind: Redirect
    package: "net/http"
    description: "HTTP redirect"
    argument: 2

  - name: "Redirect"
    kind: Redirect
    package: "net/http"
    description: "HTTP redirect"
    argument: 2

  # Trust Boundary - gorilla/sessions
  - name: "session.Values"
    kind: TrustBoundary
    package: "github.com/gorilla/sessions"
    description: "Session value storage"

  - name: "session.Save"
    kind: TrustBoundary
    package: "github.com/gorilla/sessions"
    description: "Save session with potentially tainted data"

  - name: "Sessions.Save"
    kind: TrustBoundary
    description: "Save session"

  - name: "Set"
    kind: TrustBoundary
    package: "session"
    description: "Set session value"
    argument: 1

  - name: "SetValue"
    kind: TrustBoundary
    description: "Set session value"
    argument: 2

  - name: "GlobalSessionStore.SetValue"
    kind: TrustBoundary
    description: "Set global session value"
    argument: 2

  - name: "helpers.GlobalSessionStore.SetValue"
    kind: TrustBoundary
    description: "Helper global session value"
    argument: 2

  # html/template XSS Sinks
  - name: "Execute"
    kind: HtmlOutput
    package: "html/template"
    description: "Execute template with data"
    argument: 1

  - name: "ExecuteTemplate"
    kind: HtmlOutput
    package: "html/template"
    description: "Execute named template with data"
    argument: 2

  - name: "t.Execute"
    kind: HtmlOutput
    description: "Template execute"
    argument: 1

  - name: "template.Execute"
    kind: HtmlOutput
    description: "Template execute"
    argument: 1

  # Gin Framework XSS Sinks
  - name: "c.Data"
    kind: HtmlOutput
    description: "Gin Data response (XSS if HTML content-type)"
    argument: 2

  - name: "c.String"
    kind: HtmlOutput
    description: "Gin String response"
    argument: 1

  - name: "c.HTML"
    kind: HtmlOutput
    description: "Gin HTML template response"
    argument: 2

  - name: "c.Writer.Write"
    kind: HtmlOutput
    description: "Gin writer write"
    argument: 0

  - name: "c.Writer.WriteString"
    kind: HtmlOutput
    description: "Gin writer write string"
    argument: 0

  # Echo Framework XSS Sinks
  - name: "c.HTML"
    kind: HtmlOutput
    package: "echo"
    description: "Echo HTML response"
    argument: 1

  - name: "c.String"
    kind: HtmlOutput
    package: "echo"
    description: "Echo String response"
    argument: 1

  - name: "c.Blob"
    kind: HtmlOutput
    description: "Echo Blob response"
    argument: 2

  # go-ldap LDAP Injection Sinks
  - name: "Search"
    kind: LdapQuery
    package: "github.com/go-ldap/ldap"
    description: "LDAP search"
    argument: 0

  - name: "Conn.Search"
    kind: LdapQuery
    description: "LDAP connection search"
    argument: 0

  - name: "l.Search"
    kind: LdapQuery
    description: "LDAP search"
    argument: 0

  - name: "NewSearchRequest"
    kind: LdapQuery
    package: "github.com/go-ldap/ldap"
    description: "Create LDAP search request"
    argument: 1

  # encoding/xml XXE Sinks
  - name: "NewDecoder"
    kind: XmlParse
    package: "encoding/xml"
    description: "XML decoder (XXE risk)"
    argument: 0

  - name: "xml.Unmarshal"
    kind: XmlParse
    package: "encoding/xml"
    description: "XML unmarshal (XXE risk)"
    argument: 0

  - name: "Decoder.Decode"
    kind: XmlParse
    description: "XML decode"
    argument: 0

  # Path Traversal Sinks - only actual file operations, not path construction
  # filepath.Join removed as too broad - it constructs paths but doesn't access files

  - name: "os.ReadFile"
    kind: PathTraversal
    package: "os"
    description: "Read file (path traversal risk)"
    argument: 0

  - name: "os.Open"
    kind: PathTraversal
    package: "os"
    description: "Open file (path traversal risk)"
    argument: 0

sanitizers:
  # HTML Escaping
  - name: "html.EscapeString"
    sanitizes: [Html]
    package: "html"
    description: "HTML escape string"

  - name: "template.HTMLEscapeString"
    sanitizes: [Html]
    package: "html/template"
    description: "Template HTML escape"

  - name: "template.JSEscapeString"
    sanitizes: [Html]
    package: "html/template"
    description: "Template JS escape"

  - name: "template.URLQueryEscaper"
    sanitizes: [Html]
    package: "html/template"
    description: "URL query escape"

  # SQL Sanitization (prepared statements)
  - name: "db.Prepare"
    sanitizes: [Sql]
    package: "database/sql"
    description: "Prepare statement"

  # Shell sanitization
  - name: "shellescape.Quote"
    sanitizes: [Shell]
    description: "Shell escape"

  # Type conversion
  - name: "strconv.Atoi"
    sanitizes: [All]
    package: "strconv"
    description: "String to int"

  - name: "strconv.ParseInt"
    sanitizes: [All]
    package: "strconv"
    description: "Parse integer"

  - name: "strconv.ParseFloat"
    sanitizes: [All]
    package: "strconv"
    description: "Parse float"

  # URL encoding
  - name: "url.QueryEscape"
    sanitizes: [Path]
    package: "net/url"
    description: "URL query escape"

  # Path sanitization - filepath.Base extracts only filename, preventing traversal
  - name: "filepath.Base"
    sanitizes: [Path]
    package: "path/filepath"
    description: "Extract base name (prevents path traversal)"

  - name: "path.Base"
    sanitizes: [Path]
    package: "path"
    description: "Extract base name (prevents path traversal)"

  - name: "filepath.Clean"
    sanitizes: [Path]
    package: "path/filepath"
    description: "Clean path (normalizes ..)"

  # Helper sanitizer for benchmark
  - name: "helpers.EscapeForHTML"
    sanitizes: [Html]
    description: "Helper HTML escape function"

summaries:
  # String operations
  - name: "+"
    package: "string"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "Join"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "ToLower"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "ToUpper"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "TrimSpace"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "Split"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "Replace"
    package: "strings"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  # fmt.Sprintf propagates taint
  - name: "Sprintf"
    package: "fmt"
    input: "Argument[1]"
    output: "ReturnValue"
    kind: taint

  # URL decoding
  - name: "QueryUnescape"
    package: "net/url"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: value

  # Base64 decoding
  - name: "DecodeString"
    package: "encoding/base64"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: value

  # JSON unmarshaling - taint flows from input bytes to output struct
  - name: "json.Unmarshal"
    package: "encoding/json"
    input: "Argument[0]"
    output: "Argument[1]"
    kind: taint

  - name: "Unmarshal"
    package: "encoding/json"
    input: "Argument[0]"
    output: "Argument[1]"
    kind: taint

  - name: "Decode"
    package: "encoding/json"
    input: "Argument[this]"
    output: "Argument[0]"
    kind: taint

  # YAML unmarshaling
  - name: "yaml.Unmarshal"
    package: "gopkg.in/yaml.v2"
    input: "Argument[0]"
    output: "Argument[1]"
    kind: taint

  - name: "yaml.Unmarshal"
    package: "gopkg.in/yaml.v3"
    input: "Argument[0]"
    output: "Argument[1]"
    kind: taint

  # XML decoding
  - name: "xml.Unmarshal"
    package: "encoding/xml"
    input: "Argument[0]"
    output: "Argument[1]"
    kind: taint

  - name: "Decode"
    package: "encoding/xml"
    input: "Argument[this]"
    output: "Argument[0]"
    kind: taint

  # Gob decoding
  - name: "gob.Decode"
    package: "encoding/gob"
    input: "Argument[this]"
    output: "Argument[0]"
    kind: taint

# =============================================================================
# GORM ORM Framework
# =============================================================================

additional_sinks_gorm:
  # GORM raw SQL queries (SQL injection risk)
  - name: "Raw"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM raw SQL query"
    argument: 0

  - name: "Exec"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM execute raw SQL"
    argument: 0

  - name: "Where"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM WHERE clause (unsafe if string concat)"
    argument: 0

  - name: "Or"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM OR clause (unsafe if string concat)"
    argument: 0

  - name: "Not"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM NOT clause (unsafe if string concat)"
    argument: 0

  - name: "Order"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM ORDER BY clause"
    argument: 0

  - name: "Group"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM GROUP BY clause"
    argument: 0

  - name: "Having"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM HAVING clause"
    argument: 0

  - name: "Joins"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM JOIN clause"
    argument: 0

  - name: "Select"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM SELECT clause (unsafe if string concat)"
    argument: 0

  - name: "Table"
    kind: SqlQuery
    package: "gorm.io/gorm"
    description: "GORM table name (injection risk)"
    argument: 0

# =============================================================================
# sqlx Library (Enhanced database/sql)
# =============================================================================

additional_sinks_sqlx:
  # sqlx query methods
  - name: "Get"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx get single result"
    argument: 1

  - name: "Select"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx select multiple results"
    argument: 1

  - name: "MustExec"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx must execute"
    argument: 0

  - name: "NamedExec"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx named exec"
    argument: 0

  - name: "NamedQuery"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx named query"
    argument: 0

  - name: "Rebind"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx rebind query"
    argument: 0

  - name: "In"
    kind: SqlQuery
    package: "github.com/jmoiron/sqlx"
    description: "sqlx IN clause expansion"
    argument: 0

# =============================================================================
# ent ORM Framework
# =============================================================================

additional_sinks_ent:
  # ent raw queries
  - name: "ExecContext"
    kind: SqlQuery
    package: "entgo.io/ent/dialect/sql"
    description: "ent execute context"
    argument: 1

  - name: "QueryContext"
    kind: SqlQuery
    package: "entgo.io/ent/dialect/sql"
    description: "ent query context"
    argument: 1

# =============================================================================
# Chi Router Framework
# =============================================================================

additional_sources_chi:
  # Chi router URL parameters
  - name: "URLParam"
    kind: UserInput
    package: "github.com/go-chi/chi/v5"
    description: "Chi URL parameter"

  - name: "URLParamFromCtx"
    kind: UserInput
    package: "github.com/go-chi/chi/v5"
    description: "Chi URL parameter from context"

# =============================================================================
# Gorilla Mux Router
# =============================================================================

additional_sources_gorilla:
  # Gorilla mux URL parameters
  - name: "Vars"
    kind: UserInput
    package: "github.com/gorilla/mux"
    description: "Gorilla mux URL variables"

# =============================================================================
# Additional Path Sanitizers
# =============================================================================

additional_sanitizers:
  # filepath package sanitizers
  - name: "filepath.Base"
    sanitizes: [Path]
    package: "path/filepath"
    description: "Extract base name (prevents traversal)"

  - name: "filepath.Clean"
    sanitizes: [Path]
    package: "path/filepath"
    description: "Clean path"

  - name: "filepath.Abs"
    sanitizes: [Path]
    package: "path/filepath"
    description: "Get absolute path"

  - name: "path.Base"
    sanitizes: [Path]
    package: "path"
    description: "Extract base name"

  - name: "path.Clean"
    sanitizes: [Path]
    package: "path"
    description: "Clean path"

# =============================================================================
# html/template XSS Sinks
# =============================================================================

additional_sinks_template:
  # html/template Execute - XSS if data contains user input
  - name: "Execute"
    kind: HtmlOutput
    package: "html/template"
    description: "Execute template with data"
    argument: 1

  - name: "ExecuteTemplate"
    kind: HtmlOutput
    package: "html/template"
    description: "Execute named template with data"
    argument: 2

  - name: "t.Execute"
    kind: HtmlOutput
    description: "Template execute"
    argument: 1

  - name: "t.ExecuteTemplate"
    kind: HtmlOutput
    description: "Template execute named"
    argument: 2

  - name: "template.Execute"
    kind: HtmlOutput
    description: "Template execute"
    argument: 1

  # text/template (less safe than html/template)
  - name: "Execute"
    kind: HtmlOutput
    package: "text/template"
    description: "Text template execute (no escaping)"
    argument: 1

# =============================================================================
# go-ldap LDAP Injection Sinks
# =============================================================================

additional_sinks_ldap:
  - name: "Search"
    kind: LdapQuery
    package: "github.com/go-ldap/ldap"
    description: "LDAP search"
    argument: 0

  - name: "SearchWithPaging"
    kind: LdapQuery
    package: "github.com/go-ldap/ldap"
    description: "LDAP search with paging"
    argument: 0

  - name: "Conn.Search"
    kind: LdapQuery
    description: "LDAP connection search"
    argument: 0

  - name: "l.Search"
    kind: LdapQuery
    description: "LDAP search"
    argument: 0

  - name: "NewSearchRequest"
    kind: LdapQuery
    package: "github.com/go-ldap/ldap"
    description: "Create LDAP search request"
    argument: 1

# =============================================================================
# encoding/xml XXE Sinks
# =============================================================================

additional_sinks_xxe:
  - name: "NewDecoder"
    kind: XmlParse
    package: "encoding/xml"
    description: "XML decoder (XXE risk)"
    argument: 0

  - name: "Unmarshal"
    kind: XmlParse
    package: "encoding/xml"
    description: "XML unmarshal (XXE risk)"
    argument: 0

  - name: "Decoder.Decode"
    kind: XmlParse
    description: "XML decode"
    argument: 0

  - name: "d.Decode"
    kind: XmlParse
    description: "XML decoder decode"
    argument: 0
