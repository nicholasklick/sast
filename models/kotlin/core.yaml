# Kotlin / JVM Taint Configuration
# Base sources, sinks, and sanitizers for Kotlin applications (Ktor framework + Java APIs)

sources:
  # Ktor Framework - ApplicationCall
  - name: "receiveParameters"
    kind: UserInput
    package: "io.ktor.server.request"
    description: "HTTP form parameters"

  - name: "receiveText"
    kind: UserInput
    package: "io.ktor.server.request"
    description: "HTTP request body as text"

  - name: "receive"
    kind: UserInput
    package: "io.ktor.server.request"
    description: "HTTP request body deserialized"

  # Ktor Request properties
  - name: "queryParameters"
    kind: UserInput
    package: "io.ktor.server.request.ApplicationRequest"
    description: "HTTP query parameters"

  - name: "cookies"
    kind: UserInput
    package: "io.ktor.server.request.ApplicationRequest"
    description: "HTTP cookies"

  - name: "headers"
    kind: UserInput
    package: "io.ktor.server.request.ApplicationRequest"
    description: "HTTP headers"

  - name: "path"
    kind: UserInput
    package: "io.ktor.server.request.ApplicationRequest"
    description: "HTTP request path"

  - name: "uri"
    kind: UserInput
    package: "io.ktor.server.request.ApplicationRequest"
    description: "HTTP request URI"

  # Ktor path parameters
  - name: "parameters"
    kind: UserInput
    package: "io.ktor.server.application.ApplicationCall"
    description: "Route path parameters"

  # Java Servlet API (Kotlin can use Java directly)
  - name: "getParameter"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP request parameter"

  - name: "getHeader"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP request header"

  - name: "getCookies"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP cookies"

  - name: "getQueryString"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP query string"

  - name: "getPathInfo"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP path info"

  - name: "getInputStream"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP request body stream"

  - name: "getReader"
    kind: UserInput
    package: "javax.servlet.http.HttpServletRequest"
    description: "HTTP request body reader"

  # Spring Framework (common in Kotlin)
  - name: "getParameter"
    kind: UserInput
    package: "org.springframework.web.context.request.WebRequest"
    description: "Spring request parameter"

  # Environment
  - name: "getenv"
    kind: Environment
    package: "java.lang.System"
    description: "Environment variable"

  - name: "getProperty"
    kind: Environment
    package: "java.lang.System"
    description: "System property"

  # File I/O
  - name: "readLine"
    kind: File
    package: "java.io.BufferedReader"
    description: "Read line from file/stream"

  - name: "readText"
    kind: File
    package: "kotlin.io"
    description: "Kotlin extension to read file text"

  - name: "readLines"
    kind: File
    package: "kotlin.io"
    description: "Kotlin extension to read file lines"

  - name: "readBytes"
    kind: File
    package: "kotlin.io"
    description: "Kotlin extension to read file bytes"

sinks:
  # SQL Injection - JDBC
  - name: "executeQuery"
    kind: SqlQuery
    package: "java.sql.Statement"
    description: "SQL query execution"
    argument: 0

  - name: "executeUpdate"
    kind: SqlQuery
    package: "java.sql.Statement"
    description: "SQL update execution"
    argument: 0

  - name: "execute"
    kind: SqlQuery
    package: "java.sql.Statement"
    description: "SQL execution"
    argument: 0

  - name: "prepareStatement"
    kind: SqlQuery
    package: "java.sql.Connection"
    description: "Prepared statement creation"
    argument: 0

  # Exposed Framework (popular Kotlin SQL library)
  - name: "exec"
    kind: SqlQuery
    package: "org.jetbrains.exposed.sql.Transaction"
    description: "Exposed raw SQL execution"
    argument: 0

  # Command Injection
  - name: "exec"
    kind: CommandExecution
    package: "java.lang.Runtime"
    description: "OS command execution"
    argument: 0

  - name: "start"
    kind: CommandExecution
    package: "java.lang.ProcessBuilder"
    description: "Process start"

  - name: "command"
    kind: CommandExecution
    package: "java.lang.ProcessBuilder"
    description: "Process command setting"
    argument: 0

  # Path Traversal
  - name: "FileInputStream"
    kind: PathTraversal
    package: "java.io"
    description: "File input stream constructor"
    argument: 0

  - name: "FileOutputStream"
    kind: PathTraversal
    package: "java.io"
    description: "File output stream constructor"
    argument: 0

  - name: "FileReader"
    kind: PathTraversal
    package: "java.io"
    description: "File reader constructor"
    argument: 0

  - name: "FileWriter"
    kind: PathTraversal
    package: "java.io"
    description: "File writer constructor"
    argument: 0

  - name: "File"
    kind: PathTraversal
    package: "java.io"
    description: "File constructor"
    argument: 0

  # Kotlin specific file operations
  - name: "readText"
    kind: PathTraversal
    package: "java.io.File"
    description: "Kotlin extension read text"

  # XSS / HTML Output - Ktor
  - name: "respondText"
    kind: HtmlOutput
    package: "io.ktor.server.response"
    description: "Ktor text response"
    argument: 0

  - name: "respondHtml"
    kind: HtmlOutput
    package: "io.ktor.server.html"
    description: "Ktor HTML response"

  # LDAP Injection
  - name: "search"
    kind: LdapQuery
    package: "javax.naming.directory.DirContext"
    description: "LDAP search"
    argument: 1

  - name: "lookup"
    kind: LdapQuery
    package: "javax.naming.Context"
    description: "JNDI/LDAP lookup"
    argument: 0

  # XPath Injection
  - name: "evaluate"
    kind: XPathQuery
    package: "javax.xml.xpath.XPath"
    description: "XPath evaluation"
    argument: 0

  - name: "selectNodes"
    kind: XPathQuery
    description: "XPath node selection"
    argument: 0

  # XXE / XML Parsing
  - name: "parse"
    kind: XmlParse
    package: "javax.xml.parsers.DocumentBuilder"
    description: "XML document parsing"
    argument: 0

  # Deserialization
  - name: "readObject"
    kind: Deserialization
    package: "java.io.ObjectInputStream"
    description: "Object deserialization"

  # Code Injection
  - name: "eval"
    kind: CodeEval
    package: "javax.script.ScriptEngine"
    description: "Script evaluation"
    argument: 0

  # Trust Boundary
  - name: "setAttribute"
    kind: TrustBoundary
    package: "javax.servlet.http.HttpSession"
    description: "Session attribute setting"
    argument: 1

  # Open Redirect - Ktor
  - name: "respondRedirect"
    kind: Redirect
    package: "io.ktor.server.response"
    description: "Ktor redirect response"
    argument: 0

sanitizers:
  # HTML Encoding
  - name: "escapeHtml"
    sanitizes: [Html]
    package: "org.apache.commons.text.StringEscapeUtils"
    description: "HTML escape"

  - name: "htmlEscape"
    sanitizes: [Html]
    package: "org.springframework.web.util.HtmlUtils"
    description: "Spring HTML escape"

  # URL Encoding
  - name: "encode"
    sanitizes: [All]
    package: "java.net.URLEncoder"
    description: "URL encode"

  # General Validation
  - name: "toInt"
    sanitizes: [All]
    package: "kotlin.text"
    description: "Kotlin string to int"

  - name: "toLong"
    sanitizes: [All]
    package: "kotlin.text"
    description: "Kotlin string to long"

  - name: "toIntOrNull"
    sanitizes: [All]
    package: "kotlin.text"
    description: "Kotlin safe string to int"

  - name: "parseInt"
    sanitizes: [All]
    package: "java.lang.Integer"
    description: "Parse to integer"

  # Path Sanitization
  - name: "getCanonicalPath"
    sanitizes: [Path]
    package: "java.io.File"
    description: "Canonicalize path"

  - name: "normalize"
    sanitizes: [Path]
    package: "java.nio.file.Path"
    description: "Normalize path"

summaries:
  # Kotlin String operations
  - name: "plus"
    package: "kotlin.String"
    input: "Argument[0]"
    output: "ReturnValue"
    kind: taint

  - name: "substring"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "lowercase"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "uppercase"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "trim"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "replace"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "split"
    package: "kotlin.String"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  # StringBuilder
  - name: "append"
    package: "java.lang.StringBuilder"
    input: "Argument[0]"
    output: "Argument[this]"
    kind: taint

  - name: "toString"
    package: "java.lang.StringBuilder"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: value

  # Collections
  - name: "get"
    package: "kotlin.collections.List"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint

  - name: "get"
    package: "kotlin.collections.Map"
    input: "Argument[this]"
    output: "ReturnValue"
    kind: taint
